<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detector de Distracci√≥n al Volante | IA</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        /* --- ESTILOS GENERALES Y LAYOUT --- */
        :root {
            --color-primary: #1E88E5; /* Azul brillante para acci√≥n */
            --color-secondary: #00bcd4; /* Cian para contraste */
            --color-text: #333;
            --color-background: #eef1f6;
            --color-safe: #4CAF50; /* Verde */
            --color-danger: #D32F2F; /* Rojo */
            --color-warning: #FFC107; /* Amarillo */
            --color-reset: #6c757d; /* Gris para limpiar */
        }

        body {
            font-family: 'Poppins', sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--color-background);
            color: var(--color-text);
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
        }

        .container {
            max-width: 900px;
            width: 95%;
            margin: 40px 20px;
            background: white;
            padding: 30px 40px;
            border-radius: 12px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease-in-out;
        }

        /* --- T√çTULOS Y DESCRIPCIONES --- */
        h1 {
            color: var(--color-primary);
            text-align: center;
            font-weight: 700;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        h1 svg {
            margin-right: 10px;
            fill: var(--color-primary);
        }
        .subtitle {
            text-align: center;
            color: #666;
            margin-top: 0;
            margin-bottom: 30px;
            font-weight: 300;
        }
        h2 {
            color: var(--color-text);
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
            margin-top: 30px;
            font-weight: 600;
        }

        /* --- SECCI√ìN DE SUBIDA (DRAG & DROP) --- */
        .upload-section {
            border: 3px dashed #bbdefb; /* Borde suave */
            background-color: #f7fbff; /* Fondo muy claro */
            padding: 40px 20px;
            text-align: center;
            margin-bottom: 25px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .upload-section:hover {
            border-color: var(--color-primary);
            background-color: #e3f2fd;
        }

        #upload-text {
            color: #666;
            font-weight: 600;
            font-size: 1.1em;
            display: block; /* Aseguramos que se muestre por defecto */
        }
        
        .image-preview {
            max-width: 100%;
            max-height: 350px;
            width: auto;
            height: auto;
            border: 3px solid var(--color-primary);
            margin-top: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            object-fit: contain; /* Asegura que la imagen se vea bien */
            display: none;
        }

        /* --- BOTONES DE ACCI√ìN --- */
        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 15px;
        }
        .button-group button {
            padding: 15px;
            font-size: 1.2em;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: background-color 0.3s, transform 0.2s;
        }

        #predict-button {
            flex-grow: 3; /* M√°s ancho */
            background-color: var(--color-primary);
            color: white;
            box-shadow: 0 4px 10px rgba(30, 136, 229, 0.4);
        }
        #predict-button:hover:not(:disabled) {
            background-color: #0d47a1; /* Azul m√°s oscuro */
            transform: translateY(-2px);
        }
        #predict-button:disabled {
            background-color: #bdbdbd; /* Gris deshabilitado */
            cursor: not-allowed;
            box-shadow: none;
        }

        #reset-button {
            flex-grow: 1; /* M√°s angosto */
            background-color: var(--color-reset);
            color: white;
            box-shadow: 0 4px 10px rgba(108, 117, 125, 0.4);
        }
        #reset-button:hover {
            background-color: #5a6268;
            transform: translateY(-2px);
        }

        /* --- RESULTADOS Y MENSAJES DE ESTADO --- */
        .result-box {
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            font-weight: 600;
            font-size: 1.1em;
            display: flex;
            align-items: center;
        }
        .result-box span {
            margin-right: 10px;
            font-size: 1.5em;
        }

        /* Colores de estado mejorados */
        .success { 
            background-color: #e8f5e9; 
            color: var(--color-safe); 
            border: 1px solid var(--color-safe); 
        }
        .error { 
            background-color: #ffebee; 
            color: var(--color-danger); 
            border: 1px solid var(--color-danger); 
        }
        .warning { 
            background-color: #fff8e1; 
            color: var(--color-warning); 
            border: 1px solid var(--color-warning); 
        }

        /* Estilos para los datos principales */
        .data-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #f0f0f0;
            font-size: 1.1em;
        }
        .data-item strong {
            font-weight: 700;
            color: var(--color-primary);
        }
        
        /* Ocultar la secci√≥n de probabilidades que no se usa ahora */
        #probabilities-section {
            display: none;
        }

    </style>
</head>
<body>
    <div class="container">
        <h1>
            <svg xmlns="http://www.w3.org/2000/svg" height="30px" viewBox="0 0 24 24" width="30px"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M18.92 6.01C18.72 5.42 18.16 5 17.5 5h-11c-.66 0-1.21.42-1.42 1.01L3 12v8c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-1h12v1c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-8l-2.08-5.99zM6.85 7h10.29l1.04 3H5.81l1.04-3zM19 17H5v-4.5h14V17z"/><circle cx="7.5" cy="14.5" r="1.5"/><circle cx="16.5" cy="14.5" r="1.5"/></svg>
            Detector de Distracci√≥n al Volante
        </h1>
        <p class="subtitle">An√°lisis de la conducci√≥n mediante Inteligencia Artificial (YOLOv8).</p>

        <div class="upload-section" id="upload-box">
            <input type="file" id="file-input" accept="image/*" style="display: none;">
            <p id="upload-text">üëÜ Haz clic para subir una imagen o arrastra y suelta aqu√≠</p>
            <img id="image-preview" class="image-preview" src="#" alt="Vista previa de la imagen">
        </div>
        
        <div class="button-group">
            <button onclick="predictImage()" id="predict-button" disabled>
                Analizar Imagen
            </button>
            <button onclick="resetInterface()" id="reset-button">
                Limpiar
            </button>
        </div>
        
        <div id="results-area">
            <h2>Resultados del An√°lisis</h2>
            <div id="status-message" class="result-box warning" style="display: none;"></div>
            
            <div class="data-item">
                <span>Clase Predicha:</span> 
                <strong id="predicted-class">---</strong>
            </div>
            
            <div class="data-item">
                <span>Confianza de la Predicci√≥n:</span> 
                <strong id="confidence">---</strong>
            </div>
            
            <div id="probabilities-section">
                </div>
        </div>
    </div>

    <script>
        const fileInput = document.getElementById('file-input');
        const imagePreview = document.getElementById('image-preview');
        const predictButton = document.getElementById('predict-button');
        const uploadText = document.getElementById('upload-text');
        const uploadBox = document.getElementById('upload-box');
        const statusMessage = document.getElementById('status-message');
        const predictedClass = document.getElementById('predicted-class');
        const confidenceDisplay = document.getElementById('confidence');

        // --- FUNCI√ìN PARA LIMPIAR LA INTERFAZ (NUEVA FUNCI√ìN) ---
        function resetInterface() {
            // 1. Limpiar el input de archivo
            fileInput.value = '';

            // 2. Restaurar el estado inicial del √°rea de subida
            imagePreview.style.display = 'none';
            imagePreview.src = '#';
            uploadText.style.display = 'block';

            // 3. Desactivar y limpiar botones/resultados
            predictButton.disabled = true;
            statusMessage.style.display = 'none';
            statusMessage.className = 'result-box warning';
            
            predictedClass.textContent = '---';
            confidenceDisplay.textContent = '---';
            
            console.log('Interfaz reseteada.');
        }


        // --- MANEJO DE ARCHIVOS Y DRAG & DROP ---

        function handleFile(file) {
            if (file && file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    imagePreview.src = e.target.result;
                    imagePreview.style.display = 'block';
                    uploadText.style.display = 'none';
                    predictButton.disabled = false;
                    statusMessage.style.display = 'none'; // Limpiar mensaje de estado al subir nueva imagen
                    predictedClass.textContent = '---';
                    confidenceDisplay.textContent = '---';
                };
                reader.readAsDataURL(file);
            } else {
                imagePreview.style.display = 'none';
                uploadText.style.display = 'block';
                predictButton.disabled = true;
                alert('Por favor, sube un archivo de imagen v√°lido.');
            }
        }

        // Evento de selecci√≥n de archivo normal
        fileInput.onchange = function(event) {
            handleFile(event.target.files[0]);
        };
        
        // Permite hacer clic en el √°rea de subida
        uploadBox.addEventListener('click', () => {
            fileInput.click();
        });


        // Eventos Drag and Drop
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            uploadBox.addEventListener(eventName, preventDefaults, false);
            document.body.addEventListener(eventName, preventDefaults, false); 
        });

        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        uploadBox.addEventListener('drop', handleDrop, false);
        uploadBox.addEventListener('dragenter', () => uploadBox.classList.add('hover'), false);
        uploadBox.addEventListener('dragleave', () => uploadBox.classList.remove('hover'), false);
        uploadBox.addEventListener('dragover', () => uploadBox.classList.add('hover'), false);


        function handleDrop(e) {
            const dt = e.dataTransfer;
            const files = dt.files;
            
            if (files.length) {
                fileInput.files = files; 
                handleFile(files[0]);
            }
            uploadBox.classList.remove('hover');
        }


        // --- L√ìGICA DE PREDICCI√ìN ---

        function predictImage() {
            const file = fileInput.files[0];
            if (!file) return;

            // Mostrar mensaje de carga
            statusMessage.style.display = 'block';
            statusMessage.className = 'result-box warning';
            statusMessage.innerHTML = '<span>‚è≥</span> Analizando... por favor, espera.';
            
            predictButton.disabled = true;

            const formData = new FormData();
            formData.append('file', file);

            fetch('/predict', {
                method: 'POST',
                body: formData
            })
            .then(response => {
                if (!response.ok) {
                    return response.json().then(errorData => Promise.reject(errorData));
                }
                return response.json();
            })
            .then(data => {
                predictButton.disabled = false;
                
                // Actualizar resultados
                predictedClass.textContent = data.class_name;
                confidenceDisplay.textContent = data.confidence;
                
                statusMessage.className = `result-box ${data.message_type}`;
                statusMessage.innerHTML = `<span>${data.message_type === 'success' ? '‚úÖ' : 'üö®'}</span> ${data.message}`;

            })
            .catch(error => {
                predictButton.disabled = false;
                // Manejar errores JSON del servidor o errores de red
                const errorMessage = error.error || 'Error de conexi√≥n con el servidor o archivo no v√°lido.';
                statusMessage.className = 'result-box error';
                statusMessage.innerHTML = `<span>‚ùå</span> Error: ${errorMessage}`;
                console.error('Fetch error:', error);
            });
        }
    </script>
</body>
</html>
